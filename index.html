<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            transition: all 0.3s;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #9b59b6;
            --secondary-dark: #8e44ad;
            --success: #2ecc71;
            --success-dark: #27ae60;
            --warning: #f39c12;
            --warning-dark: #e67e22;
            --danger: #e74c3c;
            --danger-dark: #c0392b;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        body.dark-mode {
            --primary: #3a86ff;
            --primary-dark: #2667cc;
            --secondary: #9d4edd;
            --secondary-dark: #7b2cbf;
            --success: #4cc9f0;
            --success-dark: #4895ef;
            --warning: #f8961e;
            --warning-dark: #f3722c;
            --danger: #f94144;
            --danger-dark: #d00000;
            --light: #1a1a2e;
            --dark: #f8f9fa;
            --gray: #b0b0b0;
            --border: #2d3748;
            --shadow: rgba(0, 0, 0, 0.3);
            --bg-gradient: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
        }
        
        body {
            background: var(--bg-gradient);
            padding: 20px;
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--light);
            border-radius: 20px;
            box-shadow: 0 15px 40px var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 { 
            font-size: 2.2em; 
            margin-bottom: 10px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .theme-toggle {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%) scale(1.1);
        }
        
        /* Page Navigation */
        .page-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }
        
        .page-btn {
            padding: 10px 25px;
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--dark);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            padding: 30px;
            background: var(--light);
        }
        
        .stat-card {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow);
            text-align: center;
            border-left: 5px solid;
            border: 1px solid var(--border);
        }
        
        .stat-card.blue { border-color: var(--primary); }
        .stat-card.purple { border-color: var(--secondary); }
        .stat-card.green { border-color: var(--success); }
        .stat-card.orange { border-color: var(--warning); }
        .stat-card.red { border-color: var(--danger); }
        
        .stat-number { 
            font-size: 2.5em; 
            font-weight: bold; 
            margin: 10px 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .blue-text { color: var(--primary); }
        .purple-text { color: var(--secondary); }
        .green-text { color: var(--success); }
        .orange-text { color: var(--warning); }
        .red-text { color: var(--danger); }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Controls Section */
        .controls {
            padding: 30px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }
        
        .product-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .payment-options {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .payment-option {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .payment-option:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .payment-option.selected {
            border-color: var(--primary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        .payment-option.flexy.selected {
            border-color: var(--secondary);
            background: rgba(155, 89, 182, 0.1);
        }
        
        .payment-radio {
            display: none;
        }
        
        .payment-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .payment-radio:checked + .payment-label .radio-custom {
            border-color: var(--primary);
            background: var(--primary);
        }
        
        .payment-radio:checked + .payment-label .radio-custom::after {
            content: '';
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
        }
        
        .payment-radio:checked + .payment-label.flexy .radio-custom {
            border-color: var(--secondary);
            background: var(--secondary);
        }
        
        .payment-icon {
            font-size: 1.2em;
        }
        
        .normal-icon {
            color: var(--primary);
        }
        
        .flexy-icon {
            color: var(--secondary);
        }
        
        .add-btn-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .add-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            min-width: 200px;
        }
        
        .add-btn:hover {
            background: var(--success-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        /* Price Display */
        .price-display {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
            text-align: center;
            border: 1px solid var(--border);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flexy-price { color: var(--secondary); font-weight: bold; }
        .normal-price { color: var(--primary); font-weight: bold; }
        .profit-display { color: var(--success); font-weight: bold; font-size: 1.2em; }
        
        /* Transactions Section */
        .transactions {
            padding: 30px;
            background: var(--light);
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .transaction-table-wrapper, .debts-table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .transaction-table, .debts-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .transaction-table th, .transaction-table td,
        .debts-table th, .debts-table td {
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .transaction-table th, .debts-table th {
            background: var(--dark);
            color: var(--light);
            position: relative;
            cursor: pointer;
        }
        
        .transaction-table th:hover, .debts-table th:hover {
            background: #34495e;
        }
        
        .normal { border-left: 4px solid var(--primary); }
        .flexy { border-left: 4px solid var(--secondary); }
        
        .type-badge {
            padding: 6px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .type-normal { background: var(--primary); }
        .type-flexy { background: var(--secondary); }
        
        .product-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 2px;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            cursor: pointer;
        }
        
        .profit-cell {
            cursor: pointer;
            font-weight: bold;
            position: relative;
        }
        
        .profit-cell:hover {
            background: rgba(46, 204, 113, 0.1);
        }
        
        .debtor-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 2px;
            background: linear-gradient(45deg, var(--danger), var(--danger-dark));
            color: white;
            cursor: pointer;
        }
        
        .debtor-badge.paid {
            background: linear-gradient(45deg, var(--success), var(--success-dark));
        }
        
        .amount-cell {
            cursor: pointer;
            font-weight: bold;
        }
        
        .amount-cell:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            min-width: 70px;
            justify-content: center;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .edit-btn {
            background: var(--primary);
        }
        
        .edit-btn:hover {
            background: var(--primary-dark);
        }
        
        .delete-btn {
            background: var(--danger);
        }
        
        .delete-btn:hover {
            background: var(--danger-dark);
        }
        
        .update-btn {
            background: var(--warning);
        }
        
        .update-btn:hover {
            background: var(--warning-dark);
        }
        
        .profit-btn {
            background: var(--success);
        }
        
        .profit-btn:hover {
            background: var(--success-dark);
        }
        
        .date-cell {
            cursor: pointer;
            font-family: monospace;
        }
        
        .date-cell:hover {
            background: rgba(155, 89, 182, 0.1);
        }
        
        /* More Button Styles */
        .more-btn-container {
            position: relative;
            display: inline-block;
        }
        
        .more-btn {
            background: var(--secondary);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .more-btn:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
        }
        
        .more-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            box-shadow: 0 5px 20px var(--shadow);
            z-index: 100;
            display: none;
            flex-direction: column;
            gap: 5px;
        }
        
        .more-options.show {
            display: flex;
        }
        
        .option-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background: var(--light);
            color: var(--dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            text-align: right;
            font-size: 14px;
            font-weight: 500;
        }
        
        .option-btn:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .option-btn.export {
            color: var(--success);
        }
        
        .option-btn.import {
            color: var(--primary);
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
            animation-fill-mode: forwards;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .toast-success { background: var(--success); }
        .toast-error { background: var(--danger); }
        .toast-info { background: var(--primary); }
        .toast-warning { background: var(--warning); }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--light);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-title {
            margin-bottom: 20px;
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }
        
        /* Checkbox */
        .select-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .product-form { grid-template-columns: 1fr 1fr; }
        }
        
        @media (max-width: 768px) {
            .product-form { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 1.8em; }
            .stat-number { font-size: 2em; }
            .payment-options { flex-direction: column; }
            .transaction-table, .debts-table { min-width: 600px; }
            .action-buttons { flex-direction: column; }
            .more-btn { padding: 10px 15px; }
            .more-options { min-width: 180px; }
        }
        
        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { border-radius: 15px; }
            .header, .controls, .transactions { padding: 20px 15px; }
            .stats-grid { padding: 20px 15px; grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
            .more-btn-container { width: 100%; }
            .more-btn { width: 100%; justify-content: center; }
            .more-options { width: 100%; }
        }
        
        input, select, button {
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: var(--light);
            color: var(--dark);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }
        
        .clear-btn { 
            background: var(--danger); 
        }
        
        .clear-btn:hover { 
            background: var(--danger-dark); 
        }
        
        .export-btn {
            background: var(--success);
        }
        
        .export-btn:hover {
            background: var(--success-dark);
        }
        
        /* Quick Profit Menu */
        .profit-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            box-shadow: 0 5px 20px var(--shadow);
            z-index: 100;
            display: none;
        }
        
        .profit-menu.show {
            display: block;
        }
        
        .profit-option {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: background-color 0.2s;
        }
        
        .profit-option:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        /* Debts Page Specific */
        .debts-controls {
            padding: 30px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }
        
        .debt-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .debt-form { grid-template-columns: 1fr; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="fas fa-moon"></i>
            </button>
            <h1><i class="fas fa-rocket"></i> Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</h1>
            <p>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­ÙŠØ© ÙˆØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©</p>
        </div>
        
        <!-- Page Navigation -->
        <div class="page-nav">
            <button class="page-btn active" onclick="showPage('sales')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
            <button class="page-btn" onclick="showPage('debts')">Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</button>
        </div>
        
        <!-- Sales Page -->
        <div id="sales-page" class="page-content active">
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card blue">
                    <h3><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©</h3>
                    <div class="stat-number blue-text" id="normalSales">0 Ø¯ÙŠÙ†Ø§Ø±</div>
                    <p id="normalCount">0 Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹</p>
                </div>
                <div class="stat-card purple">
                    <h3><i class="fas fa-credit-card"></i> Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙ„ÙŠÙƒØ³ÙŠ</h3>
                    <div class="stat-number purple-text" id="flexySales">0 Ø¯ÙŠÙ†Ø§Ø±</div>
                    <p id="flexyCount">0 Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹</p>
                </div>
                <div class="stat-card green">
                    <h3><i class="fas fa-chart-line"></i> Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                    <div class="stat-number green-text" id="dailyProfit">0 Ø¯ÙŠÙ†Ø§Ø±</div>
                    <p id="dailyCount">0 Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
                <div class="stat-card orange">
                    <h3><i class="fas fa-calendar-alt"></i> Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
                    <div class="stat-number orange-text" id="monthlyProfit">0 Ø¯ÙŠÙ†Ø§Ø±</div>
                    <p id="monthlyCount">0 Ø¹Ù…Ù„ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                </div>
            </div>
            
            <!-- Add Transaction -->
            <div class="controls">
                <h3><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h3>
                
                <!-- Product Name -->
                <div style="margin-bottom: 20px;">
                    <input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ø§Ù„: MLBB Ù…Ø§Ø³ØŒ FF Ù…Ø§Ø³ØŒ Ø¥Ù„Ø®)" style="width: 100%;">
                </div>
                
                <!-- Price Inputs -->
                <div class="product-form">
                    <input type="number" id="usdPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)" step="0.01" oninput="calculateProfit()">
                    <input type="number" id="exchangeRate" value="255" placeholder="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" step="0.01" oninput="calculateProfit()">
                    <input type="number" id="productPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ (Ø¯ÙŠÙ†Ø§Ø±)" step="0.01" oninput="calculateProfit()">
                </div>
                
                <!-- Payment Options -->
                <div class="payment-options">
                    <div class="payment-option normal selected" onclick="selectPaymentType('normal')" id="normalOption">
                        <input type="radio" name="paymentType" value="normal" id="normalPayment" class="payment-radio" checked>
                        <label for="normalPayment" class="payment-label">
                            <span class="radio-custom"></span>
                            <i class="fas fa-money-bill-wave payment-icon normal-icon"></i>
                            <span>Ø¯ÙØ¹ Ø¹Ø§Ø¯ÙŠ</span>
                        </label>
                    </div>
                    
                    <div class="payment-option flexy" onclick="selectPaymentType('flexy')" id="flexyOption">
                        <input type="radio" name="paymentType" value="flexy" id="flexyPayment" class="payment-radio">
                        <label for="flexyPayment" class="payment-label flexy">
                            <span class="radio-custom"></span>
                            <i class="fas fa-credit-card payment-icon flexy-icon"></i>
                            <span>Ø¯ÙØ¹ ÙÙ„ÙŠÙƒØ³ÙŠ</span>
                        </label>
                    </div>
                </div>
                
                <!-- Add Button -->
                <div class="add-btn-container">
                    <button class="add-btn" onclick="addTransaction()">
                        <i class="fas fa-plus-circle"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    </button>
                </div>
                
                <!-- Price Calculation Display -->
                <div class="price-display">
                    <div id="profitCalculation">
                        <div style="color: var(--gray);">
                            <i class="fas fa-arrow-left"></i> Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø±Ø¤ÙŠØ© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­
                        </div>
                    </div>
                </div>
                
                <!-- Sales Action Buttons -->
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <button class="clear-btn" onclick="clearSalesData()">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                    </button>
                    
                    <div class="more-btn-container">
                        <button class="more-btn" onclick="toggleMoreOptions('sales')">
                            <i class="fas fa-ellipsis-h"></i> Ø§Ù„Ù…Ø²ÙŠØ¯
                        </button>
                        <div class="more-options" id="salesMoreOptions">
                            <button class="option-btn export" onclick="exportSalesData()">
                                <i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                            </button>
                            <button class="option-btn import" onclick="importSalesData()">
                                <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Transactions Table -->
            <div class="transactions">
                <div class="table-controls">
                    <div class="selection-controls">
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="select-checkbox">
                        <label for="selectAll">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</label>
                        <button onclick="deleteSelectedSales()" class="clear-btn" style="padding: 8px 15px; font-size: 14px;">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                        </button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="salesSearchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª..." style="width: 100%;" oninput="filterSalesTable()">
                    </div>
                </div>
                
                <div class="transaction-table-wrapper">
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;"><input type="checkbox" id="headerCheckbox" onchange="toggleSelectAll()"></th>
                                <th onclick="sortSalesTable('productName')">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th onclick="sortSalesTable('type')">Ø§Ù„Ù†ÙˆØ¹</th>
                                <th onclick="sortSalesTable('usdPrice')">Ø³Ø¹Ø± $</th>
                                <th onclick="sortSalesTable('cost')">Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                                <th onclick="sortSalesTable('productPrice')">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th onclick="sortSalesTable('profit')">Ø§Ù„Ø±Ø¨Ø­</th>
                                <th onclick="sortSalesTable('date')">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th style="width: 200px;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Debts Page -->
        <div id="debts-page" class="page-content">
            <!-- Debts Statistics -->
            <div class="stats-grid">
                <div class="stat-card red">
                    <h3><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</h3>
                    <div class="stat-number red-text" id="totalDebtors">0 Ø´Ø®Øµ</div>
                    <p id="activeDebts">0 Ø¯ÙŠÙ† Ù†Ø´Ø·</p>
                </div>
                <div class="stat-card orange">
                    <h3><i class="fas fa-money-bill-wave"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†</h3>
                    <div class="stat-number orange-text" id="totalDebts">0 Ø¯ÙŠÙ†Ø§Ø±</div>
                    <p id="averageDebt">0 Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯ÙŠÙ†</p>
                </div>
                <div class="stat-card green">
                    <h3><i class="fas fa-money-bill"></i> Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</h3>
                    <div class="stat-number green-text" id="paidCount">0 Ø¯ÙŠÙ†</div>
                    <p>Ø¯ÙŠÙˆÙ† ØªÙ… Ø³Ø¯Ø§Ø¯Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                </div>
            </div>
            
            <!-- Add Debt -->
            <div class="debts-controls">
                <h3><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙˆÙ† Ø¬Ø¯ÙŠØ¯</h3>
                
                <div class="debt-form">
                    <input type="text" id="debtorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†" style="width: 100%;">
                    <input type="number" id="debtAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ† (Ø¯ÙŠÙ†Ø§Ø±)" step="0.01">
                    <button class="add-btn" onclick="addDebt()" style="min-width: auto;">
                        <i class="fas fa-plus-circle"></i>
                        Ø¥Ø¶Ø§ÙØ©
                    </button>
                </div>
                
                <!-- Debts Action Buttons -->
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <button class="clear-btn" onclick="clearAllDebts()">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†
                    </button>
                    
                    <div class="more-btn-container">
                        <button class="more-btn" onclick="toggleMoreOptions('debts')">
                            <i class="fas fa-ellipsis-h"></i> Ø§Ù„Ù…Ø²ÙŠØ¯
                        </button>
                        <div class="more-options" id="debtsMoreOptions">
                            <button class="option-btn export" onclick="exportDebts()">
                                <i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙŠÙˆÙ†
                            </button>
                            <button class="option-btn import" onclick="importDebts()">
                                <i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Debts Table -->
            <div class="transactions">
                <div class="table-controls">
                    <div class="search-box">
                        <input type="text" id="debtSearchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†..." style="width: 100%;" oninput="filterDebtsTable()">
                    </div>
                </div>
                
                <div class="debts-table-wrapper">
                    <table class="debts-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th onclick="sortDebtsTable('name')">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†</th>
                                <th onclick="sortDebtsTable('amount')">Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†</th>
                                <th onclick="sortDebtsTable('date')">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th style="width: 220px;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="debtsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Quick Profit Menu -->
    <div class="profit-menu" id="profitMenu">
        <div class="profit-option" onclick="addQuickProfit(50)">+50 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="addQuickProfit(100)">+100 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="addQuickProfit(200)">+200 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="addQuickProfit(500)">+500 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="addQuickProfit(-50)">-50 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="addQuickProfit(-100)">-100 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="profit-option" onclick="openCustomProfitModal()">Ù…Ø¨Ù„Øº Ù…Ø®ØµØµ</div>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="customProfitModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-money-bill-wave"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø­ Ù…Ø®ØµØµ</h3>
            <div style="margin-bottom: 20px;">
                <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ø³ØªØ®Ø¯Ù… + Ù„Ù„Ø²ÙŠØ§Ø¯Ø© Ùˆ - Ù„Ù„Ù†Ù‚ØµØ§Ù†):</label>
                <input type="text" id="customProfitAmount" placeholder="Ù…Ø«Ø§Ù„: +100 Ø£Ùˆ -50" style="width: 100%; margin-top: 5px;">
            </div>
            <div class="modal-actions">
                <button onclick="saveCustomProfit()" class="export-btn"><i class="fas fa-check"></i> ØªØ·Ø¨ÙŠÙ‚</button>
                <button onclick="closeCustomProfitModal()" class="clear-btn"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="updateDebtModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-exchange-alt"></i> ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†</h3>
            <div id="updateDebtModalContent"></div>
            <div class="modal-actions">
                <button onclick="saveDebtUpdate()" class="export-btn"><i class="fas fa-check"></i> ØªØ·Ø¨ÙŠÙ‚</button>
                <button onclick="closeUpdateDebtModal()" class="clear-btn"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="addProfitModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-money-bill"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø­ Ø¬Ø¯ÙŠØ¯</h3>
            <div id="addProfitModalContent"></div>
            <div class="modal-actions">
                <button onclick="saveNewProfit()" class="export-btn"><i class="fas fa-check"></i> ØªØ·Ø¨ÙŠÙ‚</button>
                <button onclick="closeAddProfitModal()" class="clear-btn"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        console.log("ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…...");
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        let exchangeRate = 255;
        let currentProfitId = null;
        let currentDebtorId = null;
        let currentTransactionId = null;
        let profitMenuOpen = false;
        let paymentType = 'normal';
        let paidDebtsCount = 0;
        
        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let transactions = JSON.parse(localStorage.getItem('salesTransactions')) || [];
        let debts = JSON.parse(localStorage.getItem('debtsData')) || [];
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
        let currentPage = 'sales';
        let salesSortColumn = 'timestamp';
        let salesSortDirection = 'desc';
        let debtSortColumn = 'timestamp';
        let debtSortDirection = 'desc';
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log("âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²");
            loadThemePreference();
            loadData();
            showPage('sales');
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.profit-cell') && !e.target.closest('.profit-menu')) {
                    hideProfitMenu();
                }
                if (!e.target.closest('.more-btn-container')) {
                    document.getElementById('salesMoreOptions').classList.remove('show');
                    document.getElementById('debtsMoreOptions').classList.remove('show');
                }
            });
        });
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ ===
        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(page + '-page').classList.add('active');
            document.querySelector(`.page-btn[onclick*="${page}"]`).classList.add('active');
            
            currentPage = page;
            
            if (page === 'sales') {
                updateSales();
            } else if (page === 'debts') {
                updateDebts();
            }
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ===
        function loadData() {
            updateSales();
            updateDebts();
            checkForZeroDebts();
        }
        
        function selectPaymentType(type) {
            paymentType = type;
            document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
            document.getElementById(type + 'Option').classList.add('selected');
            document.getElementById(type + 'Payment').checked = true;
            calculateProfit();
        }
        
        function calculateProfit() {
            const usdPrice = parseFloat(document.getElementById('usdPrice').value) || 0;
            const rate = parseFloat(document.getElementById('exchangeRate').value) || exchangeRate;
            const productPrice = parseFloat(document.getElementById('productPrice').value) || 0;
            
            if (!usdPrice || !productPrice) {
                document.getElementById('profitCalculation').innerHTML = 
                    '<div style="color: var(--gray);"><i class="fas fa-arrow-left"></i> Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø±Ø¤ÙŠØ© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­</div>';
                return;
            }
            
            exchangeRate = rate;
            let cost = paymentType === 'flexy' ? (usdPrice * rate) / 0.82 : usdPrice * rate;
            let profit = productPrice - cost;
            
            document.getElementById('profitCalculation').innerHTML = `
                <div><i class="fas fa-money-bill-wave normal-price"></i> <span class="normal-price">Ø§Ù„ØªÙƒÙ„ÙØ©:</span> ${formatNumber(cost)} Ø¯ÙŠÙ†Ø§Ø±</div>
                <div><i class="fas fa-tag"></i> <span>Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬:</span> ${formatNumber(productPrice)} Ø¯ÙŠÙ†Ø§Ø±</div>
                <div class="profit-display"><i class="fas fa-money-bill"></i> Ø§Ù„Ø±Ø¨Ø­: ${formatNumber(profit)} Ø¯ÙŠÙ†Ø§Ø±</div>
            `;
        }
        
        function addTransaction() {
            const usdPrice = parseFloat(document.getElementById('usdPrice').value);
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            const productName = document.getElementById('productName').value.trim();
            
            if (!usdPrice || !productPrice || !productName) {
                showToast('âš ï¸ Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return;
            }
            
            let cost = paymentType === 'flexy' ? (usdPrice * exchangeRate) / 0.82 : usdPrice * exchangeRate;
            let profit = productPrice - cost;
            const now = new Date();
            const timestamp = now.getTime();
            const date = formatDate(timestamp);
            
            const transaction = {
                id: timestamp,
                productName: productName,
                type: paymentType,
                usdPrice: usdPrice,
                cost: cost,
                productPrice: productPrice,
                profit: profit,
                additionalProfits: [],
                date: date,
                timestamp: timestamp,
                selected: false
            };
            
            // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            transactions.unshift(transaction);
            saveSalesData();
            updateSales();
            
            document.getElementById('productName').value = '';
            document.getElementById('usdPrice').value = '';
            document.getElementById('productPrice').value = '';
            
            showToast(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${productName}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        }
        
        function updateSales() {
            updateSalesStatistics();
            updateTransactionsTable();
        }
        
        function updateSalesStatistics() {
            const now = new Date();
            const today = formatDate(now.getTime());
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            let stats = {
                dailyProfit: 0,
                monthlyProfit: 0,
                normalSales: 0,
                flexySales: 0,
                dailyCount: 0,
                monthlyCount: 0,
                normalCount: 0,
                flexyCount: 0
            };
            
            transactions.forEach(t => {
                const totalProfit = t.profit + (t.additionalProfits?.reduce((sum, p) => sum + p.amount, 0) || 0);
                const date = new Date(t.timestamp);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ - Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙŠØºØ© YYYY/MM/DD Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                if (formatDate(t.timestamp) === today) {
                    stats.dailyProfit += totalProfit;
                    stats.dailyCount++;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ - Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
                if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
                    stats.monthlyProfit += totalProfit;
                    stats.monthlyCount++;
                }
                
                if (t.type === 'normal') {
                    stats.normalSales += t.productPrice;
                    stats.normalCount++;
                } else {
                    stats.flexySales += t.productPrice;
                    stats.flexyCount++;
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('dailyProfit').textContent = formatNumber(stats.dailyProfit) + ' Ø¯ÙŠÙ†Ø§Ø±';
            document.getElementById('monthlyProfit').textContent = formatNumber(stats.monthlyProfit) + ' Ø¯ÙŠÙ†Ø§Ø±';
            document.getElementById('normalSales').textContent = formatNumber(stats.normalSales) + ' Ø¯ÙŠÙ†Ø§Ø±';
            document.getElementById('flexySales').textContent = formatNumber(stats.flexySales) + ' Ø¯ÙŠÙ†Ø§Ø±';
            document.getElementById('dailyCount').textContent = stats.dailyCount + ' Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…';
            document.getElementById('monthlyCount').textContent = stats.monthlyCount + ' Ø¹Ù…Ù„ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±';
            document.getElementById('normalCount').textContent = stats.normalCount + ' Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹';
            document.getElementById('flexyCount').textContent = stats.flexyCount + ' Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹';
        }
        
        function updateTransactionsTable() {
            const tbody = document.getElementById('transactionsBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù… Ø­Ø³Ø¨ timestamp
            const sortedTransactions = [...transactions].sort((a, b) => {
                if (salesSortColumn === 'timestamp') {
                    return salesSortDirection === 'asc' ? a.timestamp - b.timestamp : b.timestamp - a.timestamp;
                } else if (salesSortColumn === 'productName') {
                    return salesSortDirection === 'asc' 
                        ? a.productName.localeCompare(b.productName)
                        : b.productName.localeCompare(a.productName);
                } else if (salesSortColumn === 'profit') {
                    const aProfit = a.profit + (a.additionalProfits?.reduce((sum, p) => sum + p.amount, 0) || 0);
                    const bProfit = b.profit + (b.additionalProfits?.reduce((sum, p) => sum + p.amount, 0) || 0);
                    return salesSortDirection === 'asc' ? aProfit - bProfit : bProfit - aProfit;
                } else if (salesSortColumn === 'date') {
                    return salesSortDirection === 'asc' ? a.timestamp - b.timestamp : b.timestamp - a.timestamp;
                }
                return 0;
            });
            
            sortedTransactions.forEach(t => {
                const totalProfit = t.profit + (t.additionalProfits?.reduce((sum, p) => sum + p.amount, 0) || 0);
                const profitClass = totalProfit >= 0 ? 'green-text' : 'red-text';
                const profitSign = totalProfit >= 0 ? '+' : '';
                const hasAdditional = t.additionalProfits?.length > 0;
                
                const row = `
                    <tr class="${t.type === 'normal' ? 'normal' : 'flexy'} ${t.selected ? 'selected' : ''}">
                        <td><input type="checkbox" class="select-checkbox" ${t.selected ? 'checked' : ''} onchange="toggleSelect(${t.id})"></td>
                        <td>
                            <span class="product-badge" onclick="editProduct(${t.id})">
                                ${t.productName}
                                ${hasAdditional ? ` <small>(+${t.additionalProfits.length})</small>` : ''}
                            </span>
                        </td>
                        <td><span class="type-badge type-${t.type}">${t.type === 'normal' ? 'Ø¹Ø§Ø¯ÙŠ' : 'ÙÙ„ÙŠÙƒØ³ÙŠ'}</span></td>
                        <td>${t.usdPrice} $</td>
                        <td>${formatNumber(t.cost)} Ø¯ÙŠÙ†Ø§Ø±</td>
                        <td>${formatNumber(t.productPrice)} Ø¯ÙŠÙ†Ø§Ø±</td>
                        <td class="profit-cell" onclick="showProfitMenu(${t.id}, event)">
                            <span class="${profitClass}">${profitSign}${formatNumber(totalProfit)} Ø¯ÙŠÙ†Ø§Ø±</span>
                            ${hasAdditional ? ' ğŸ’°' : ''}
                        </td>
                        <td class="date-cell">${t.date}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editProduct(${t.id})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬">
                                    <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                <button class="action-btn profit-btn" onclick="addNewProfit(${t.id})" title="Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø­">
                                    <i class="fas fa-money-bill"></i> Ø±Ø¨Ø­
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteTransaction(${t.id})" title="Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø­ Ø¬Ø¯ÙŠØ¯ ===
        function addNewProfit(id) {
            currentTransactionId = id;
            const transaction = transactions.find(t => t.id === id);
            
            const totalProfit = transaction.profit + (transaction.additionalProfits?.reduce((sum, p) => sum + p.amount, 0) || 0);
            
            document.getElementById('addProfitModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
                    <div style="background: var(--border); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <strong>${transaction.productName}</strong>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                    <div style="background: var(--border); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <strong>${formatNumber(totalProfit)} Ø¯ÙŠÙ†Ø§Ø±</strong>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label>Ø±Ø¨Ø­ Ø¬Ø¯ÙŠØ¯ (Ø§Ø³ØªØ®Ø¯Ù… + Ù„Ù„Ø²ÙŠØ§Ø¯Ø© Ùˆ - Ù„Ù„Ù†Ù‚ØµØ§Ù†):</label>
                    <input type="text" id="newProfitAmount" placeholder="Ù…Ø«Ø§Ù„: +100 Ø£Ùˆ -50" style="width: 100%; margin-top: 5px;">
                </div>
            `;
            
            document.getElementById('addProfitModal').style.display = 'flex';
            document.getElementById('newProfitAmount').focus();
        }
        
        function saveNewProfit() {
            const input = document.getElementById('newProfitAmount').value.trim();
            if (!input || !currentTransactionId) return;
            
            const transaction = transactions.find(t => t.id === currentTransactionId);
            if (!transaction) return;
            
            let amount = 0;
            
            if (input.startsWith('+')) {
                amount = parseFloat(input.substring(1)) || 0;
            } else if (input.startsWith('-')) {
                amount = -parseFloat(input.substring(1)) || 0;
            } else {
                amount = parseFloat(input) || 0;
            }
            
            if (!isNaN(amount)) {
                if (!transaction.additionalProfits) transaction.additionalProfits = [];
                
                transaction.additionalProfits.push({
                    amount: amount,
                    date: formatDate(Date.now()),
                    timestamp: Date.now()
                });
                
                saveSalesData();
                updateSales();
                closeAddProfitModal();
                
                const action = amount >= 0 ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚ØµØ§Ù†';
                showToast(`âœ… ØªÙ… ${action} Ø§Ù„Ø±Ø¨Ø­ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(amount)} Ø¯ÙŠÙ†Ø§Ø±`, 'success');
            }
        }
        
        function closeAddProfitModal() {
            document.getElementById('addProfitModal').style.display = 'none';
            currentTransactionId = null;
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ===
        function editProduct(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© prompt Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            const newName = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:', transaction.productName);
            if (newName !== null && newName.trim() !== '') {
                transaction.productName = newName.trim();
                saveSalesData();
                updateSales();
                showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'success');
            }
        }
        
        function deleteTransaction(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')) {
                transactions = transactions.filter(t => t.id !== id);
                saveSalesData();
                updateSales();
                showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'success');
            }
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ø±ÙŠØ¹ ===
        function showProfitMenu(id, event) {
            event.preventDefault();
            event.stopPropagation();
            
            currentProfitId = id;
            
            const menu = document.getElementById('profitMenu');
            const cell = event.target.closest('.profit-cell');
            const rect = cell.getBoundingClientRect();
            
            menu.style.display = 'block';
            menu.style.left = (rect.left - 210) + 'px';
            menu.style.top = rect.bottom + 'px';
            menu.classList.add('show');
            
            profitMenuOpen = true;
        }
        
        function hideProfitMenu() {
            const menu = document.getElementById('profitMenu');
            menu.classList.remove('show');
            profitMenuOpen = false;
        }
        
        function addQuickProfit(amount) {
            if (!currentProfitId) return;
            
            const transaction = transactions.find(t => t.id === currentProfitId);
            if (transaction) {
                if (!transaction.additionalProfits) transaction.additionalProfits = [];
                
                transaction.additionalProfits.push({
                    amount: amount,
                    date: formatDate(Date.now()),
                    timestamp: Date.now()
                });
                
                saveSalesData();
                updateSales();
                hideProfitMenu();
                
                const action = amount >= 0 ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚ØµØ§Ù†';
                showToast(`âœ… ØªÙ… ${action} Ø§Ù„Ø±Ø¨Ø­ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(amount)} Ø¯ÙŠÙ†Ø§Ø±`, 'success');
            }
        }
        
        function openCustomProfitModal() {
            hideProfitMenu();
            document.getElementById('customProfitModal').style.display = 'flex';
            document.getElementById('customProfitAmount').focus();
        }
        
        function saveCustomProfit() {
            const input = document.getElementById('customProfitAmount').value.trim();
            if (!input) return;
            
            let amount = 0;
            
            if (input.startsWith('+')) {
                amount = parseFloat(input.substring(1)) || 0;
            } else if (input.startsWith('-')) {
                amount = -parseFloat(input.substring(1)) || 0;
            } else {
                amount = parseFloat(input) || 0;
            }
            
            if (!isNaN(amount)) {
                addQuickProfit(amount);
                closeCustomProfitModal();
            }
        }
        
        function closeCustomProfitModal() {
            document.getElementById('customProfitModal').style.display = 'none';
            document.getElementById('customProfitAmount').value = '';
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø²Ø± Ø§Ù„Ù…Ø²ÙŠØ¯ ===
        function toggleMoreOptions(type) {
            const salesOptions = document.getElementById('salesMoreOptions');
            const debtsOptions = document.getElementById('debtsMoreOptions');
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø£ÙˆÙ„Ø§Ù‹
            salesOptions.classList.remove('show');
            debtsOptions.classList.remove('show');
            
            // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (type === 'sales') {
                salesOptions.classList.toggle('show');
            } else if (type === 'debts') {
                debtsOptions.classList.toggle('show');
            }
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ===
        function exportSalesData() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `sales-backup-${formatDate(Date.now()).replace(/\//g, '-')}.json`);
            link.click();
            
            showToast('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'success');
            document.getElementById('salesMoreOptions').classList.remove('show');
        }
        
        function importSalesData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        if (!Array.isArray(importedData)) {
                            throw new Error('ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                        }
                        
                        // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        transactions = [...importedData, ...transactions];
                        saveSalesData();
                        updateSales();
                        
                        showToast(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedData.length} Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨ÙŠØ¹Ø§Øª`, 'success');
                        document.getElementById('salesMoreOptions').classList.remove('show');
                    } catch (error) {
                        showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function exportDebts() {
            const dataStr = JSON.stringify(debts, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `debts-backup-${formatDate(Date.now()).replace(/\//g, '-')}.json`);
            link.click();
            
            showToast('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†', 'success');
            document.getElementById('debtsMoreOptions').classList.remove('show');
        }
        
        function importDebts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        if (!Array.isArray(importedData)) {
                            throw new Error('ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                        }
                        
                        // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        debts = [...importedData, ...debts];
                        saveDebtsData();
                        updateDebts();
                        
                        showToast(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedData.length} Ø¯ÙŠÙ†`, 'success');
                        document.getElementById('debtsMoreOptions').classList.remove('show');
                    } catch (error) {
                        showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ† ===
        function addDebt() {
            const name = document.getElementById('debtorName').value.trim();
            const amount = parseFloat(document.getElementById('debtAmount').value);
            
            if (!name || !amount) {
                showToast('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ù…Ø¨Ù„Øº', 'error');
                return;
            }
            
            const timestamp = Date.now();
            const debt = {
                id: timestamp,
                name: name,
                amount: amount,
                date: formatDate(timestamp),
                timestamp: timestamp
            };
            
            // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            debts.unshift(debt);
            saveDebtsData();
            updateDebts();
            
            document.getElementById('debtorName').value = '';
            document.getElementById('debtAmount').value = '';
            
            showToast(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙˆÙ† Ø¬Ø¯ÙŠØ¯: ${name}`, 'success');
        }
        
        function updateDebts() {
            updateDebtsStatistics();
            updateDebtsTable();
            checkForZeroDebts();
        }
        
        function updateDebtsStatistics() {
            const activeDebts = debts.filter(d => d.amount > 0);
            const totalDebtors = activeDebts.length;
            const totalDebts = activeDebts.reduce((sum, d) => sum + d.amount, 0);
            const averageDebt = totalDebtors > 0 ? totalDebts / totalDebtors : 0;
            
            document.getElementById('totalDebtors').textContent = totalDebtors + ' Ø´Ø®Øµ';
            document.getElementById('totalDebts').textContent = formatNumber(totalDebts) + ' Ø¯ÙŠÙ†Ø§Ø±';
            document.getElementById('averageDebt').textContent = formatNumber(averageDebt) + ' Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯ÙŠÙ†';
            document.getElementById('activeDebts').textContent = totalDebtors + ' Ø¯ÙŠÙ† Ù†Ø´Ø·';
            document.getElementById('paidCount').textContent = paidDebtsCount + ' Ø¯ÙŠÙ† Ù…Ø³Ø¯Ø¯';
        }
        
        function updateDebtsTable() {
            const tbody = document.getElementById('debtsBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            const sortedDebts = [...debts].sort((a, b) => {
                if (debtSortColumn === 'timestamp') {
                    return debtSortDirection === 'asc' ? a.timestamp - b.timestamp : b.timestamp - a.timestamp;
                } else if (debtSortColumn === 'name') {
                    return debtSortDirection === 'asc' 
                        ? a.name.localeCompare(b.name)
                        : b.name.localeCompare(a.name);
                } else if (debtSortColumn === 'amount') {
                    return debtSortDirection === 'asc' ? a.amount - b.amount : b.amount - a.amount;
                } else if (debtSortColumn === 'date') {
                    return debtSortDirection === 'asc' ? a.timestamp - b.timestamp : b.timestamp - a.timestamp;
                }
                return 0;
            });
            
            sortedDebts.forEach((d, index) => {
                const isPaid = d.amount <= 0;
                const badgeClass = isPaid ? 'paid' : '';
                
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <span class="debtor-badge ${badgeClass}" onclick="editDebtor(${d.id})">
                                ${d.name}
                                ${isPaid ? ' (Ù…Ø³Ø¯Ø¯)' : ''}
                            </span>
                        </td>
                        <td class="amount-cell" onclick="updateDebtAmount(${d.id})">
                            ${formatNumber(d.amount)} Ø¯ÙŠÙ†Ø§Ø±
                        </td>
                        <td class="date-cell">${d.date}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editDebtor(${d.id})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…">
                                    <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                <button class="action-btn update-btn" onclick="updateDebtAmount(${d.id})" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº">
                                    <i class="fas fa-exchange-alt"></i> ØªØ­Ø¯ÙŠØ«
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteDebt(${d.id})" title="Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // === Ø®Ø§ØµÙŠØ© Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ† Ù„Ù„ØµÙØ± ===
        function checkForZeroDebts() {
            let deletedCount = 0;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„ØªÙŠ ÙˆØµÙ„Øª Ù„Ù„ØµÙØ±
            debts.forEach(debt => {
                if (debt.amount <= 0 && !debt.markedForDeletion) {
                    debt.markedForDeletion = true;
                    deletedCount++;
                    paidDebtsCount++;
                }
            });
            
            // Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© ÙˆØ¬ÙŠØ²Ø©
            if (deletedCount > 0) {
                setTimeout(() => {
                    debts = debts.filter(d => d.amount > 0);
                    saveDebtsData();
                    updateDebts();
                    if (deletedCount > 0) {
                        showToast(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø¯ÙŠÙ† ÙˆØµÙ„ Ù…Ø¨Ù„ØºÙ‡ Ù„Ù„ØµÙØ±`, 'success');
                    }
                }, 500);
            }
        }
        
        function editDebtor(id) {
            const debtor = debts.find(d => d.id === id);
            if (!debtor) return;
            
            const newName = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†:', debtor.name);
            if (newName !== null && newName.trim() !== '') {
                debtor.name = newName.trim();
                saveDebtsData();
                updateDebts();
                showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†', 'success');
            }
        }
        
        function updateDebtAmount(id) {
            currentDebtorId = id;
            const debt = debts.find(d => d.id === id);
            
            document.getElementById('updateDebtModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <label>Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†:</label>
                    <div style="background: var(--border); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <strong>${debt.name}</strong>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                    <div style="background: var(--border); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <strong>${formatNumber(debt.amount)} Ø¯ÙŠÙ†Ø§Ø±</strong>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ø³ØªØ®Ø¯Ù… + Ù„Ù„Ø²ÙŠØ§Ø¯Ø© Ùˆ - Ù„Ù„Ù†Ù‚ØµØ§Ù†):</label>
                    <input type="text" id="debtUpdateAmount" placeholder="Ù…Ø«Ø§Ù„: +100 Ø£Ùˆ -50 Ø£Ùˆ 200" style="width: 100%; margin-top: 5px;">
                </div>
            `;
            
            document.getElementById('updateDebtModal').style.display = 'flex';
            document.getElementById('debtUpdateAmount').focus();
        }
        
        function saveDebtUpdate() {
            const input = document.getElementById('debtUpdateAmount').value.trim();
            if (!input || !currentDebtorId) return;
            
            const debt = debts.find(d => d.id === currentDebtorId);
            if (!debt) return;
            
            let newAmount = debt.amount;
            
            if (input.startsWith('+')) {
                const amount = parseFloat(input.substring(1)) || 0;
                newAmount = debt.amount + amount;
            } else if (input.startsWith('-')) {
                const amount = parseFloat(input.substring(1)) || 0;
                newAmount = debt.amount - amount;
            } else {
                newAmount = parseFloat(input) || debt.amount;
            }
            
            if (!isNaN(newAmount)) {
                debt.amount = newAmount;
                saveDebtsData();
                updateDebts();
                closeUpdateDebtModal();
                showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†', 'success');
            }
        }
        
        function closeUpdateDebtModal() {
            document.getElementById('updateDebtModal').style.display = 'none';
            currentDebtorId = null;
        }
        
        function deleteDebt(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙŠÙ†ØŸ')) {
                debts = debts.filter(d => d.id !== id);
                saveDebtsData();
                updateDebts();
                showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†', 'success');
            }
        }
        
        function clearAllDebts() {
            if (confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                debts = [];
                paidDebtsCount = 0;
                saveDebtsData();
                updateDebts();
                showToast('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†', 'success');
            }
        }
        
        function clearSalesData() {
            if (confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                transactions = [];
                saveSalesData();
                updateSales();
                showToast('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'success');
            }
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ===
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }
        
        function saveSalesData() {
            localStorage.setItem('salesTransactions', JSON.stringify(transactions));
        }
        
        function saveDebtsData() {
            localStorage.setItem('debtsData', JSON.stringify(debts));
        }
        
        function formatNumber(num) {
            if (num === null || num === undefined || isNaN(num)) return '0';
            return Math.round(num).toLocaleString('en-US');
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = { 
                success: 'fa-check-circle', 
                error: 'fa-exclamation-circle', 
                info: 'fa-info-circle', 
                warning: 'fa-exclamation-triangle' 
            };
            
            toast.innerHTML = `<i class="fas ${icons[type]}"></i> ${message}`;
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
        
        function toggleTheme() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            document.querySelector('.theme-toggle i').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            showToast(isDarkMode ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™' : 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ â˜€ï¸', 'info');
        }
        
        function loadThemePreference() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle i').className = 'fas fa-sun';
            }
        }
        
        // === ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ© ===
        function toggleSelect(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) transaction.selected = !transaction.selected;
            updateTransactionsTable();
        }
        
        function toggleSelectAll() {
            const checked = document.getElementById('selectAll').checked;
            transactions.forEach(t => t.selected = checked);
            updateTransactionsTable();
        }
        
        function deleteSelectedSales() {
            const selected = transactions.filter(t => t.selected);
            if (selected.length === 0) {
                showToast('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª', 'warning');
                return;
            }
            
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ${selected.length} Ø¹Ù…Ù„ÙŠØ©ØŸ`)) {
                transactions = transactions.filter(t => !t.selected);
                saveSalesData();
                updateSales();
                showToast(`âœ… ØªÙ… Ø­Ø°Ù ${selected.length} Ø¹Ù…Ù„ÙŠØ©`, 'success');
            }
        }
        
        function filterSalesTable() {
            const search = document.getElementById('salesSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#transactionsBody tr');
            
            rows.forEach(row => {
                const productName = row.querySelector('.product-badge')?.textContent?.toLowerCase() || '';
                if (productName.includes(search)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function filterDebtsTable() {
            const search = document.getElementById('debtSearchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#debtsBody tr');
            
            rows.forEach(row => {
                const debtorName = row.querySelector('.debtor-badge')?.textContent?.toLowerCase() || '';
                if (debtorName.includes(search)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function sortSalesTable(column) {
            if (salesSortColumn === column) {
                salesSortDirection = salesSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                salesSortColumn = column;
                salesSortDirection = 'desc';
            }
            updateTransactionsTable();
        }
        
        function sortDebtsTable(column) {
            if (debtSortColumn === column) {
                debtSortDirection = debtSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                debtSortColumn = column;
                debtSortDirection = 'desc';
            }
            updateDebtsTable();
        }
        
        console.log("ğŸ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø§Ù‡Ø²!");
    </script>
</body>
</html>